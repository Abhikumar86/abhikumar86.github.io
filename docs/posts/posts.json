[
  {
    "path": "posts/2021-07-21-singrauli-map/",
    "title": "Singrauli Map",
    "description": "A short description of the post.",
    "author": [
      {
        "name": "Abhishek Kumar",
        "url": "https://akumar.netlify.app"
      }
    ],
    "date": "2021-07-21",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nLoad the packages\r\nPrepare a base hillshade\r\nadd water element\r\nadd major roads\r\nadd coal mine boundaries\r\nprepare inset map\r\nfinal main map\r\narrange and save the final maps\r\n\r\n\r\nLoad the packages\r\n\r\n\r\nShow code\r\n\r\nlibrary(dplyr)\r\nlibrary(grid) # arranging inset maps\r\nlibrary(OpenStreetMap) # OSM Maps and data\r\nlibrary(osmdata) # osm data download\r\nlibrary(raster) # raster data and operations\r\nlibrary(sf) # simple features for spatial data\r\nlibrary(tmap) # thematic mapping\r\nlibrary(tmaptools) \r\n\r\n\r\n\r\nPrepare a base hillshade\r\n\r\n\r\nShow code\r\n\r\nbb <- c(82.48, 24.1, 82.8, 24.2) # extent for target site as left, bottom, right, upper\r\n\r\n#dem <- getData(name = \"SRTM\", lon = 84, lat = 24, path = \"./dem/\") # download data from SRTM\r\n\r\n#dem_crop <- dem %>% crop(extent(82.48, 82.8, 24.1, 24.2)) # cropped to target site\r\n#rm(dem) # remove dem from environment\r\n\r\n#slope <- terrain(dem_crop, opt= \"slope\") # extract slope from dem_crop\r\n#aspect <- terrain(dem_crop, opt= \"aspect\") # extract aspect from dem_crop\r\n#dem_hs <- hillShade(slope = slope, aspect = aspect, angle = 45, direction = 315) # prepare hill shade\r\n# 45 altitude angle and 315 azimuth angle\r\n\r\n#writeRaster(x = dem_hs, filename = \"./data/dem_hs.tif\", overwrite = T) # write to local directory\r\n#rm(slope, aspect) # removed slope and aspect files\r\n\r\nhs <- raster(\"./data/dem_hs.tif\") # read the hillshade file\r\n\r\ntm_shape(hs) + \r\n      tm_raster(palette = \"-Greys\", n = 100, style = \"cont\", alpha = 0.7,\r\n                         legend.show = FALSE)\r\n\r\n\r\n\r\n\r\nadd water element\r\n\r\n\r\nShow code\r\n\r\n# https://storage.googleapis.com/earthenginepartners-hansen/GFC-2019-v1.7/Hansen_GFC-2019-v1.7_datamask_30N_080E.tif\r\n\r\n#water <- raster(\"./data/Hansen_GFC2014_datamask_30N_080E.tif\") %>% \r\n      #crop(extent(82.48, 82.8, 24.1, 24.2)) %>% \r\n      #calc(fun = function(x){x[x == 1] <- NA; return(x)})\r\n#writeRaster(x = water, filename = \"./data/singrauli-water.tif\", overwrite = T) # write to local directory\r\n\r\nwater <- raster(\"./data/singrauli-water.tif\") # read the hillshade file\r\n\r\n# colors for water #4a80f5, #9bbff4, #a7cdf2, #AADAFF\r\n\r\ntm_shape(hs) + \r\n      tm_raster(palette = \"-Greys\", n = 100, style = \"cont\", alpha = 0.7,\r\n                         legend.show = FALSE) + # hillshade\r\n      tm_shape(water) + \r\n      tm_raster(palette = c(\"#9bbff4\"), style = \"cat\", legend.show = FALSE)  # water\r\n\r\n\r\n\r\n\r\nadd major roads\r\n\r\n\r\nShow code\r\n\r\n#s_roads <- opq(bbox = bb) %>% # xmin, ymin, xmax, ymax\r\n      #add_osm_feature(key = \"highway\", value = c(\"trunk\")) %>% \r\n      #osmdata_sf()\r\n#s_roads <- s_roads$osm_lines\r\n#st_write(s_roads, \"./data/singrauli-road/singrauli-road.shp\")\r\n\r\ns_roads <- st_read(\"./data/singrauli-road/singrauli-road.shp\")\r\n\r\n\r\nReading layer `singrauli-road' from data source \r\n  `D:\\R\\abhikumar86.github.io\\_posts\\2021-07-21-singrauli-map\\data\\singrauli-road\\singrauli-road.shp' \r\n  using driver `ESRI Shapefile'\r\nSimple feature collection with 30 features and 9 fields\r\nGeometry type: LINESTRING\r\nDimension:     XY\r\nBounding box:  xmin: 82.4536 ymin: 24.08979 xmax: 82.77473 ymax: 24.20791\r\nGeodetic CRS:  GCS_unknown\r\n\r\nShow code\r\n\r\ns_roads <- s_roads %>% st_set_crs(4326)\r\n\r\ntm_shape(hs) + tm_raster(palette = \"-Greys\", n = 100, style = \"cont\", alpha = 0.7,\r\n                         legend.show = FALSE) + # hillshade\r\n      \r\n      tm_shape(water) + tm_raster(palette = c(\"#9bbff4\"), style = \"cat\",  \r\n                            legend.show = FALSE) + # water\r\n      \r\n      tm_shape(s_roads) + tm_lines(col = \"ref\", palette = c(\"grey50\", \"grey40\"),\r\n                                   lwd = 2.5, legend.col.show = FALSE) # roads\r\n\r\n\r\n\r\n\r\nadd coal mine boundaries\r\n\r\n\r\nShow code\r\n\r\n#s_mines <- opq(bbox = bb) %>% # xmin, ymin, xmax, ymax\r\n       #add_osm_feature(key = \"landuse\", value = \"quarry\") %>% \r\n       #osmdata_sf()\r\n#s_mines <- s_mines$osm_polygons\r\n#st_write(s_mines, \"./data/singrauli-mines/singrauli-mines.shp\")\r\n\r\n# coal mines\r\ncm <- st_read(\"./data/singrauli-mines/singrauli-mines.shp\") \r\n\r\n\r\nReading layer `singrauli-mines' from data source \r\n  `D:\\R\\abhikumar86.github.io\\_posts\\2021-07-21-singrauli-map\\data\\singrauli-mines\\singrauli-mines.shp' \r\n  using driver `ESRI Shapefile'\r\nSimple feature collection with 10 features and 5 fields\r\nGeometry type: POLYGON\r\nDimension:     XY\r\nBounding box:  xmin: 82.54869 ymin: 24.11217 xmax: 82.77247 ymax: 24.21588\r\nGeodetic CRS:  GCS_unknown\r\n\r\nShow code\r\n\r\ncm$mine <- c(\"Khadia\", \"\", \"Bina\", \"Amlohri\", \"Dudhichua\", \"\", \r\n             \"Jhingurdah\", \"Kakri\", \"Nigahi\", \"Block-B\")\r\n\r\n# jayant mine\r\ncmj <- cm %>% dplyr::filter(name == \"Jayant Mine\") \r\ncmj$mine <- \"Jayant\"\r\n\r\ntm_shape(hs) + tm_raster(palette = \"-Greys\", n = 100, style = \"cont\", alpha = 0.7,\r\n                         legend.show = FALSE) + # hillshade\r\n      \r\n      tm_shape(water) + tm_raster(palette = c(\"#9bbff4\"), style = \"cat\",  \r\n                            legend.show = FALSE) + # water\r\n      \r\n      tm_shape(s_roads) + tm_lines(col = \"ref\", palette = c(\"grey50\", \"grey40\"),\r\n                                   lwd = 2.5, legend.col.show = FALSE) + # roads\r\n      tm_shape(cm) + \r\n      tm_fill(col = \"yellow\", alpha = 0.1) + \r\n      tm_borders(col = \"grey50\") +\r\n      tm_text(text = \"mine\") + # coal mine shapes\r\n      \r\n      tm_shape(cmj) + tm_fill(col = \"yellow\", alpha = 0.5) + \r\n      tm_text(text = \"mine\") +\r\n      tm_borders(col = \"black\")  # Jayant Mine shape\r\n\r\n\r\n\r\n\r\nprepare inset map\r\nhttps://map.igismap.com/gis-data/india/administrative_state_boundary?utm_source=website&utm_medium=datadownload&utm_campaign=india\r\nhttps://map.igismap.com/gis-data/india/administrative_assembly_constituencies_boundary?utm_source=website&utm_medium=datadownload&utm_campaign=india\r\n\r\n\r\nShow code\r\n\r\n# https://www.naturalearthdata.com/download/50m/cultural/ne_50m_admin_0_countries.zip\r\nworld_adm <- st_read(\"D:/spatial-data/admin/ne_world_adm/ne_50m_admin_0_countries.shp\")\r\n\r\n\r\nReading layer `ne_50m_admin_0_countries' from data source \r\n  `D:\\spatial-data\\admin\\ne_world_adm\\ne_50m_admin_0_countries.shp' \r\n  using driver `ESRI Shapefile'\r\nSimple feature collection with 241 features and 94 fields\r\nGeometry type: MULTIPOLYGON\r\nDimension:     XY\r\nBounding box:  xmin: -180 ymin: -89.99893 xmax: 180 ymax: 83.59961\r\nGeodetic CRS:  WGS 84\r\n\r\nShow code\r\n\r\n# Indian states\r\nind_adm <- st_read(\"D:/spatial-data/admin/ind_adm1/ind_adm1.shp\")\r\n\r\n\r\nReading layer `ind_adm1' from data source \r\n  `D:\\spatial-data\\admin\\ind_adm1\\ind_adm1.shp' using driver `ESRI Shapefile'\r\nSimple feature collection with 37 features and 4 fields\r\nGeometry type: MULTIPOLYGON\r\nDimension:     XY\r\nBounding box:  xmin: 68.09348 ymin: 6.754368 xmax: 97.4115 ymax: 37.07761\r\nGeodetic CRS:  WGS 84\r\n\r\nShow code\r\n\r\n# https://map.igismap.com/gis-data/india/administrative_outline_boundary?utm_source=website&utm_medium=datadownload&utm_campaign=india\r\n\r\nind_adm0 <- st_read(\"D:/spatial-data/admin/ind_adm0/ind_adm0.shp\")\r\n\r\n\r\nReading layer `ind_adm0' from data source \r\n  `D:\\spatial-data\\admin\\ind_adm0\\ind_adm0.shp' using driver `ESRI Shapefile'\r\nSimple feature collection with 1 feature and 4 fields\r\nGeometry type: MULTIPOLYGON\r\nDimension:     XY\r\nBounding box:  xmin: 68.18625 ymin: 6.755953 xmax: 97.41529 ymax: 37.07827\r\nGeodetic CRS:  WGS 84\r\n\r\nShow code\r\n\r\n#s_bb <- bb_poly(hs, projection = 4326) # bounding box \r\n\r\ns_bb <- st_bbox(obj = c(xmin = 81.5, xmax = 83.5, ymin = 23.5, ymax = 24.5),\r\n                    crs = st_crs(hs)) %>% \r\n      st_as_sfc()\r\n\r\ninset_map <- tm_shape(world_adm, bbox = st_bbox(ind_adm)) + \r\n      tm_fill(col = \"grey95\") +\r\n      \r\n      tm_shape(ind_adm) + tm_fill(col = \"grey90\") + tm_borders(col = \"grey70\", lwd = 0.5) +\r\n      \r\n      tm_shape(ind_adm0) + tm_borders(lwd = 0.75) +\r\n      \r\n      tm_shape(s_bb) + tm_borders(col = \"red\", lwd = 0.75) +\r\n      \r\n      tm_layout(bg.color = \"#9bbff4\", frame = \"grey85\")\r\n\r\n#rm(cm, cmj, hs, ind_adm, ind_adm0, s_bb, s_roads, water, world_adm) # remove undesired files\r\n\r\n\r\n\r\naspect ratios for main map and inset map\r\n\r\n\r\nShow code\r\n\r\n# aspect ratio for main map\r\nxy <- st_bbox(hs)\r\nasp <- (xy$ymax - xy$ymin)/(xy$xmax - xy$xmin) \r\n\r\n# aspect ratio inset map\r\nxy <- st_bbox(ind_adm)\r\nasp2 <- (xy$ymax - xy$ymin)/(xy$xmax - xy$xmin)\r\n\r\n\r\n\r\nfinal main map\r\n\r\n\r\nShow code\r\n\r\nmain_map <- tm_shape(hs) + \r\n      tm_raster(palette = \"-Greys\", n = 100, style = \"cont\", alpha = 0.7,\r\n                legend.show = FALSE) + # hillshade\r\n      \r\n      tm_graticules(col = \"grey80\") + # graticules\r\n      \r\n      tm_shape(water) + \r\n      tm_raster(palette = c(\"#9bbff4\"), style = \"cat\", legend.show = FALSE) + # water\r\n      \r\n      tm_shape(s_roads) + \r\n      tm_lines(col = \"grey50\", lwd = 2.5) + # roads\r\n      \r\n      tm_shape(cm) + \r\n      tm_fill(col = \"yellow\", alpha = 0.1) + \r\n      tm_borders(col = \"grey50\") +\r\n      tm_text(text = \"mine\") + # coal mine shapes\r\n      \r\n      tm_shape(cmj) + tm_fill(col = \"yellow\", alpha = 0.5) + \r\n      tm_text(text = \"mine\") +\r\n      tm_borders(col = \"black\") + # Jayant Mine shape\r\n      \r\n      tm_compass(position = c(\"right\", \"top\")) + # North Arrow\r\n      \r\n      tm_scale_bar(position = c(0.6, 0.015), breaks = c(0, 2.5, 5, 7.5, 10)) + # scale\r\n      \r\n      tm_add_legend(type = \"fill\", labels = \"Coal Mine\", col = \"yellow\", alpha = 0.1,\r\n                    border.col = \"grey50\") + # mine legend\r\n      tm_add_legend(type = \"line\", labels = \"Road\", col = \"grey50\", lwd = 2.5) + # road legend\r\n      tm_add_legend(type = \"fill\", labels = \"Water\", col = \"#9bbff4\", border.col = NA) + # water legend\r\n      \r\n      tm_layout(legend.position = c(0.0035, 0.01), legend.width = 0.6, legend.height = 0.6*asp2,\r\n                legend.bg.color = \"white\", legend.bg.alpha = 0.9,\r\n                legend.text.size = 0.75, legend.frame = \"grey85\")\r\n\r\nmain_map\r\n\r\n\r\n\r\n\r\narrange and save the final maps\r\n# Create viewport\r\nvp <- viewport(x = 0.115, y = 0.98, width = unit(1, \"inches\"), \r\n               height = unit(1*asp2, \"inches\"), just = c(\"left\", \"top\"))\r\n\r\n# save the map\r\ntmap_save(main_map, filename = \"./data/singrauli-map.png\", insets_tm = inset_map, \r\n          insets_vp = vp, height = asp*7, width = 7, units = \"in\", dpi = 300)\r\n\r\n# save map in pdf\r\ntmap_save(main_map, filename = \"./data/singrauli-map.pdf\", insets_tm = inset_map, \r\n          insets_vp = vp, height = asp*7, width = 7, units = \"in\", dpi = 300)\r\n\r\n\r\nShow code\r\n\r\nknitr::include_graphics(\"./data/singrauli-map.png\")\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/2021-07-21-singrauli-map/singrauli-map_files/figure-html5/hillshade-1.png",
    "last_modified": "2021-07-21T01:29:03+05:30",
    "input_file": {},
    "preview_width": 1248,
    "preview_height": 768
  },
  {
    "path": "posts/welcome/",
    "title": "Welcome to Abhishek Kumar",
    "description": "Welcome to our new blog, Abhishek Kumar. We hope you enjoy \nreading what we have to say!",
    "author": [
      {
        "name": "Abhishek Kumar",
        "url": "https://akumar.netlify.app"
      }
    ],
    "date": "2021-07-21",
    "categories": [],
    "contents": "\r\n\r\n\r\n\r\n",
    "preview": {},
    "last_modified": "2021-07-21T01:12:12+05:30",
    "input_file": {}
  }
]
